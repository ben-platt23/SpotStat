<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist</title>
    <link rel="stylesheet" href="../stylesheets/styles.css">
</head>
<body>
    <div id="top-margin">
        <h1>Playlist <br> Generator</h1>
    </div>
    <?php
        include 'nav.html';
        // secret tokens
        include '../PRIVATE/tokens.php'
    ?>
    <div id="playlist-content">
        <img src="../images/knowledge.png" alt="Picture of a man with a lightbulb" id="knowledge">
        <div id="iheading-container">
            <h1 id="insights-header">Your Recent Listening Habits!</h1>
        </div>
        <div id="table-container">
            <?php
                // get the posted information
                $a_or_t = stripcslashes($_POST['a-or-t']);
                $time_frame = stripcslashes($_POST['time-frame']);

                // STEP 1: get our auth token from the authorization phase (see tod-insights.php).
                session_start();
                $token = $_SESSION["token"];

                // STEP 2: GET THE DATA FROM SPOTIFY USING OUR TOKEN
                // Generated by curl-to-PHP: http://incarnate.github.io/curl-to-php/
                $ch = curl_init();
                //$endpoint = 'https://api.spotify.com/v1/me/top/'.$a_or_t.'?time_range='.$time_frame.'&limit=5&offset=0';
                curl_setopt($ch, CURLOPT_URL, 'https://api.spotify.com/v1/me/top/'.$a_or_t.'?time_range='.$time_frame.'&limit=5&offset=0');
                //print($endpoint."<br>");
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'GET');


                $headers = array();
                $auth = 'Authorization: Bearer '.$token;
                //print($auth."<br>");
                $headers[] = $auth;
                curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
                
                try{
                    $result = curl_exec($ch);
                } catch (Exception $e) {
                    echo 'Caught exception: ',  $e->getMessage(), "\n";
                }
                if (curl_errno($ch)) {
                    echo 'Error:' . curl_error($ch);
                }
                sleep(1);
                //$actualResult = curl_getinfo($ch, CURLINFO_HTTP_CODE);
                curl_close($ch);
                
                // print out our data into a p tag with an id
                // Now our javascript can process this down to the data that we want.
                print("<p id='json-data'>".$result."</p>");
                // we also want to let the javascript know whether it's processing artists or tracks, 
                // and what time frame
                print("<p id='a-or-t'>".$a_or_t."</p>");
                print("<p id='time-frame'>".$time_frame."</p>");
                //$result = json_decode($result, true);
                //print($result['href']);
            ?>
            <div id="iheading-container">
                <h2 id="insights-header">Here's your data! Press 'submit' to commit it to the database.</h2>
            </div>
            <div>
                <form action="insights-add.php" id="artists-form" method="post">
                    <div id="data-background">
                        <label> Artists or Tracks? </label><input type="text" name="aort" id="aort1"><br>
                        <label> Time Frame? </label><input type="text" name="time-frame" id="time1"><br>
                    </div> <br> <br>
                    <div id="new-artist">
                        <label>Ranking:</label> <input type="number" name="rank1" id="rank1"><br>
                        <label>Artist Name:</label> <input type="text" name="name1" id="name1"><br>
                        <label>Artist genre:</label> <input type="text" name="genre1" id="genre1"><br>
                        <label>Popularity (1-100):</label> <input type="number" name="popularity1" id="popularity1"><br>
                    </div> <br> <br>
                    <div id="new-artist">
                        <label>Ranking: </label><input type="number" name="rank2" id="rank2"><br>
                        <label>Artist Name:</label> <input type="text" name="name2" id="name2"><br>
                        <label>Artist genre:</label> <input type="text" name="genre2" id="genre2"><br>
                        <label>Popularity (1-100):</label> <input type="number" name="popularity2" id="popularity2"><br>
                    </div> <br> <br>
                    <div id="new-artist">
                        <label>Ranking:</label> <input type="number" name="rank3" id="rank3"><br>
                        <label>Artist Name:</label> <input type="text" name="name3" id="name3"><br>
                        <label>Artist genre:</label> <input type="text" name="genre3" id="genre3"><br>
                        <label>Popularity (1-100):</label> <input type="number" name="popularity3" id="popularity3"><br>
                    </div> <br> <br>
                    <div id="new-artist">
                        <label>Ranking:</label> <input type="number" name="rank4" id="rank4"><br>
                        <label>Artist Name:</label> <input type="text" name="name4" id="name4"><br>
                        <label>Artist genre:</label> <input type="text" name="genre4" id="genre4"><br>
                        <label>Popularity (1-100):</label> <input type="number" name="popularity4" id="popularity4"><br>
                    </div> <br> <br>
                    <div id="new-artist">
                        <label>Ranking:</label> <input type="number" name="rank5" id="rank5"><br>
                        <label>Artist Name:</label> <input type="text" name="name5" id="name5"><br>
                        <label>Artist genre:</label> <input type="text" name="genre5" id="genre5"><br>
                        <label>Popularity (1-100):</label> <input type="number" name="popularity5" id="popularity5"><br>
                    </div> <br> <br>
                    <input type="submit" name="Submit" value="Submit" id="submit-button">
                </form>
                <form action="insights-add.php" id="tracks-form" method="post">
                    <div id="data-background">
                        <label>Artists or Tracks?</label> <input type="text" name="aort" id="aort2"><br>
                        <label>Time Frame?</label> <input type="text" name="time-frame" id="time2"><br>
                    </div> <br> <br>
                    <div id="new-track">
                        <label>Ranking:</label> <input type="number" name="rank1" id="t-rank1"><br>
                        <label>Track Name:</label> <input type="text" name="name1" id="t-name1"><br>
                        <label>Artist Name:</label> <input type="text" name="artist1" id="artist1"><br>
                        <label>Track Release Date:</label> <input type="text" name="release1" id="release1"><br>
                        <label>Track Popularity (1-100):</label> <input type="number" name="popularity1" id="t-popularity1"><br>
                    </div> <br> <br>
                    <div id="new-track">
                        <label>Ranking:</label> <input type="number" name="rank2" id="t-rank2"><br>
                        <label>Track Name:</label> <input type="text" name="name2" id="t-name2"><br>
                        <label>Artist Name:</label> <input type="text" name="artist2" id="artist2"><br>
                        <label>Track Release Date:</label> <input type="text" name="release2" id="release2"><br>
                        <label>Track Popularity (1-100):</label> <input type="number" name="popularity2" id="t-popularity2"><br>
                    </div> <br> <br>
                    <div id="new-track">
                        <label>Ranking:</label> <input type="number" name="rank3" id="t-rank3"><br>
                        <label>Track Name:</label> <input type="text" name="name3" id="t-name3"><br>
                        <label>Artist Name:</label> <input type="text" name="artist3" id="artist3"><br>
                        <label>Track Release Date:</label> <input type="text" name="release3" id="release3"><br>
                        <label>Track Popularity (1-100):</label> <input type="number" name="popularity3" id="t-popularity3"><br>
                    </div> <br> <br>
                    <div id="new-track">
                        <label>Ranking:</label> <input type="number" name="rank4" id="t-rank4"><br>
                        <label>Track Name:</label> <input type="text" name="name4" id="t-name4"><br>
                        <label>Artist Name:</label> <input type="text" name="artist4" id="artist4"><br>
                        <label>Track Release Date:</label> <input type="text" name="release4" id="release4"><br>
                        <label>Track Popularity (1-100):</label> <input type="number" name="popularity4" id="t-popularity4"><br>
                    </div> <br> <br>
                    <div id="new-track">
                        <label>Ranking:</label> <input type="number" name="rank5" id="t-rank5"><br>
                        <label>Track Name:</label> <input type="text" name="name5" id="t-name5"><br>
                        <label>Artist Name:</label> <input type="text" name="artist5" id="artist5"><br>
                        <label>Track Release Date:</label> <input type="text" name="release5" id="release5"><br>
                        <label>Track Popularity (1-100):</label> <input type="number" name="popularity5" id="t-popularity5"><br>
                    </div> <br> <br>
                    <input type="submit" name="Submit" value="Submit" id="submit-button">
                </form>
            </div>
            <script src="../scripts/ProcessJSON.js"></script>
        </div>
    </div>
</body>
</html>